<!DOCTYPE html>
<html>
<head>
    <title>ShotSafe Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="../Styles/styles.css">
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <img src="../images/shotsafe logo.png" alt="ShotSafe Logo">
            <h2>ShotSafe</h2>
        </div>
        <nav>
            <a href="dashboard.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="appointments.html" class="nav-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Appointments</span>
            </a>
            <a href="profile.html" class="nav-item">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
            <a href="about.html" class="nav-item active">
                <i class="fas fa-info-circle"></i>
                <span>About Us</span>
            </a>
            <a href="logout.php" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>


    <div class="content">
        <div class="header">
            <input type="text" placeholder="Search..."/>
            <i class="fas fa-user"></i>
        </div>
        <div class="breadcrumbs">
            <a href="dashboard.html">Home</a> &gt;
            <span>Profile</span>
        </div>

        <div class="profile-container">
            <h2>Personal Information</h2>
            <button id="toggle-profile-form" class="btn primary">Update Profile</button>
            <form id="profile-form" style="display: none;">
                <div class="form-group">
                    <label for="fname">First Name</label>
                    <input type="text" id="fname" name="fname" required>
                </div>
                <div class="form-group">
                    <label for="mname">Middle Name</label>
                    <input type="text" id="mname" name="mname">
                </div>
                <div class="form-group">
                    <label for="lname">Last Name</label>
                    <input type="text" id="lname" name="lname" required>
                </div>
                <div class="form-group">
                    <label for="birthday">Birthday</label>
                    <input type="date" id="birthday" name="birthday" required>
                </div>
                <div class="form-group">
                    <label for="mail">Email</label>
                    <input type="email" id="mail" name="mail" required>
                </div>
                <div class="form-group">
                    <label for="contact">Contact Number</label>
                    <input type="tel" id="contact" name="contact" required>
                </div>
                <div class="form-group">
                    <label for="sex">Sex</label>
                    <select id="sex" name="sex" required>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="civilstat">Civil Status</label>
                    <select id="civilstat" name="civilstat" required>
                        <option value="Single">Single</option>
                        <option value="Married">Married</option>
                        <option value="Widowed">Widowed</option>
                        <option value="Divorced">Divorced</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nationality">Nationality</label>
                    <input type="text" id="nationality" name="nationality">
                </div>
                <div class="form-group">
                    <label for="employmentstat">Employment Status</label>
                    <select id="employmentstat" name="employmentstat" required>
                        <option value="Employed">Employed</option>
                        <option value="Unemployed">Unemployed</option>
                        <option value="Student">Student</option>
                        <option value="Retired">Retired</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="employer">Employer</label>
                    <input type="text" id="employer" name="employer">
                </div>
                <div class="form-group">
                    <label for="profession">Profession</label>
                    <input type="text" id="profession" name="profession">
                </div>
                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" name="address" required>
                </div>
                <div class="form-group">
                    <label for="barangay">Barangay</label>
                    <input type="text" id="barangay" name="barangay">
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn primary">Save Changes</button>
                    <button type="reset" class="btn secondary">Reset</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../Scripts/sidebar.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const profileForm = document.getElementById('profile-form');
            const toggleButton = document.getElementById('toggle-profile-form');

            // Toggle form visibility
            toggleButton.addEventListener('click', function() {
                profileForm.style.display = profileForm.style.display === 'none' ? 'block' : 'none';
            });

            // Load profile data
            try {
                const response = await fetch('../BackEnd/profile.php?action=get_profile');
                if (!response.ok) throw new Error('Failed to fetch profile');
                const profileData = await response.json();
                
                // Fill form with profile data
                Object.keys(profileData).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) input.value = profileData[key];
                });
            } catch (error) {
                console.error('Error loading profile:', error);
                alert('Failed to load profile data');
            }

            // Handle form submission
            profileForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                try {
                    const formData = {};
                    new FormData(this).forEach((value, key) => {
                        formData[key] = value;
                    });

                    const response = await fetch('../BackEnd/profile.php?action=update_profile', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();
                    if (result.success) {
                        alert('Profile updated successfully');
                    } else {
                        throw new Error(result.message || 'Failed to update profile');
                    }
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert(error.message);
                }
            });
        });
    </script>
</body>
</html> 