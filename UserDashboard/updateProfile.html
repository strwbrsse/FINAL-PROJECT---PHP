<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stylesheet.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link href="plugins/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="updateProfile.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Profile Management</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            margin-top: 100px;
        }

        html, body {
            height: 100%;
            display: flex;
            justify-content: center; 
            align-items: center;    
            background-color: #f0f0f0; 
        }

        .form-container {
            width: 1600px; 
            background-color: white; 
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); 
        }

        button {
            background-color: lightblue;
            width: 100% !important;
            margin-top: 15px !important;
        }

        .button-container {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <form id="profileForm">
            <h1>Personal Information</h1>
            <label for="fname">First Name</label>
            <input type="text" id="fname" name="fname" required>
            <input type="hidden" id="userId" name="userId" value="1" required>

            <label for="mname">Middle Name</label>
            <input type="text" id="mname" name="mname" required>

            <label for="lname">Last Name</label>
            <input type="text" id="lname" name="lname" required>
            
            <label for="sex">Gender</label>
            <input type="text" id="sex" name="sex" required>
            
            <label for="mail">Email</label>
            <input type="text" id="mail" name="mail" required>

            <label for="contact">Contact Number</label>
            <input type="text" id="contact" name="contact" required>
            
            <label for="birthday">Date of Birth</label>
            <input type="date" id="birthday" name="birthday" required>
            
            <label for="address">Address</label>
            <input type="text" id="address" name="address" required>

            <label for="barangay">Barangay</label>
            <input type="text" id="barangay" name="barangay" required>
            
            <label for="civilstat">Civil Status</label>
            <input type="text" id="civilstat" name="civilstat" required>

            <label for="employmentstat">Employment Status</label>
            <input type="text" id="employmentstat" name="employmentstat" required>
            
            <label for="employer">Employer</label>
            <input type="text" id="employer" name="employer" required>
            
            <label for="profession">Profession</label>
            <input type="text" id="profession" name="profession" required>

            <label for="profession">Allergy Description</label>
            <input type="text" id="allergy" name="allergy" required>

            <label for="profession">Disease Description</label>
            <input type="text" id="disease" name="disease" required>
            
            <div class="button-container" style="margin-top: 5px;">
                <button onclick="submitFunction()" type="button" style="margin-right: 10px; background: #20638f; color: #f0f0f0;">Save</button>
                <button onclick="deleteFunction()" type="button" style="margin-right: 10px; background: #DA4453;  color: #f0f0f0;">Delete</button>
                <button onclick="cancelUpdateInfo()" type="button" style="background: #727274;  color: #f0f0f0;">Cancel</button>
            </div>
        </form>
        
      
    </div> 
    
    <script src="plugins/sweetalert2-master/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function(){
            var userId = document.getElementById("userId").value;
            $.ajax({
                url: 'getProfile.php',                        
                type: 'POST',                                  
                data : { userId: userId },
                success: function(response){    // response contains json object in it
                    var data = JSON.parse(response);

                    if(data){
                        $('#fname').val(data.fname);
                        $('#mname').val(data.mname);
                        $('#lname').val(data.lname);
                        $('#birthday').val(data.birthday);
                        $('#mail').val(data.email);
                        $('#contact').val(data.contact);
                        $('#address').val(data.address);
                        $('#barangay').val(data.barangay);
                        $('#sex').val(data.sex);
                        $('#civilstat').val(data.civilstat);
                        $('#employmentstat').val(data.employment_stat);
                        $('#employer').val(data.employer);
                        $('#profession').val(data.profession);
                        $('#allergy').val(data.allergy_description);
                        $('#disease').val(data.disease_description);
                        
                    }
                }
            });

        });

        function submitFunction() {
            var fname = document.getElementById("fname").value;
            var mname = document.getElementById("mname").value;
            var lname = document.getElementById("lname").value;
            var birthday = document.getElementById("birthday").value;
            var mail = document.getElementById("mail").value;
            var contact = document.getElementById("contact").value;
            var address = document.getElementById("address").value;
            var barangay = document.getElementById("barangay").value;
            var sex = document.getElementById("sex").value;
            var userId = document.getElementById("userId").value;
            var civilstat = document.getElementById("civilstat").value;
            var employmentstat = document.getElementById("employmentstat").value;
            var employer = document.getElementById("employer").value;
            var profession = document.getElementById("profession").value;
            var allergy = document.getElementById("allergy").value;
            var disease = document.getElementById("disease").value;

            $.ajax({
                type : "POST",  //type of method
                url  : "updateProfile.php",  //your page
                data : { fname: fname, mname: mname, lname: lname, birthday: birthday, mail: mail, contact: contact,
                    address: address, barangay: barangay, sex: sex, civilstat: civilstat, employmentstat: employmentstat,
                    employer: employer, profession: profession, userId: userId, allergy : allergy, disease : disease },// passing the values
                success: function(response){ 
                    response = response.trim(); 
                    if(response === "success"){
                        Swal.fire({
                            title: 'Successfully Updated!',
                            text  : ''
                        }).then(function(){
                            location.reload();
                        })
                    }else{
                        Swal.fire({
                            title : 'Cannot updated records',
                            text  : 'Please check your inputs'
                        })
                    }
                }
            });
            
        }

        function deleteFunction() {
            var userId = document.getElementById("userId").value;
                    
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'No, cancel!',
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: 'POST',
                        url: 'deleteProfile.php',  // URL of the PHP script to delete the profile
                        data: { userId: userId },  // Sending a flag to indicate the delete action
                        success: function(response) {
                            response = response.trim();
                            if (response === "success") {
                                swal.fire({
                                    title: 'Deleted!',
                                    text: 'Your profile has been deleted.'
                                }).then(() => {
                                   deleteProfile(); // Redirect to signup.html
                                });
                            } else {
                                swal.fire({
                                    title: 'Error!',
                                    text: 'An error occurred while deleting your profile.'
                                });
                            }
                        }
                    });

                } else {
                    // Handle when the user cancels
                    console.log('User cancelled the action');
                }
            });
        }  
    </script>
</body>
</html>

